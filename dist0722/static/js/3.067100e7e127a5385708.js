webpackJsonp([3],{"3cXf":function(t,e,a){t.exports={default:a("q1bu"),__esModule:!0}},PcTC:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("rVsN"),i=a.n(s),n=a("3cXf"),o=a.n(n),r=a("a8s2"),l=a("ZSpD"),c={components:{commonTop:r.a,setTimeItem:l.a},data:function(){return{title:"新增计划",examRoomId:"",roomList:[],realSeatings:"",provinceCode:"",tableData:[],examLevClassify:[{label:"25级 — 10级 30分钟",id:1},{label:"9 级 — 1 级  45分钟",id:2},{label:"1 段 — 4 段  60分钟",id:3},{label:"5 段   90分钟",id:4}],dialogFormVisible:!1,form:{examLev:1},selectDate:"",timeList:[],showDelIcon:!1,addStatus:0,delStatus:0,recoveryStatus:0,page:null,total:null,totalPage:null,pageSize:6,dialogVisible:!1,errorList:[],timeOff:5,muchDate:""}},methods:{getData:function(t){var e=this;this.$http.get("/api/plan/room_plan",t).then(function(t){t&&(e.tableData=[],e.totalPage=t.data.data.totalPage,e.total=t.data.data.total,e.pageSize=t.data.data.pageSize,e.page=t.data.data.page,e.tableData=t.data.data.rows,e.tableData.length>0?e.delStatus=1:e.delStatus=0,e.tableData.forEach(function(t,e){t.openTime=t.signOpenDate.split(" ")[0]+" "+t.signOpenTime}))})},chooseRoom:function(t){this.addStatus=1;var e=this.roomList.filter(function(e){return e.id===t});this.realSeatings=e[0].seatSize-e[0].spareSeatSize;var a=new URLSearchParams;a.append("roomId",t),a.append("activeStatus",0),a.append("provinceCode",11e4),this.getData({params:a})},showDelIconEvent:function(){this.showDelIcon=!this.showDelIcon,!1===this.showDelIcon&&this.$store.dispatch("resetDeledeleCurrentRowId",null),this.showDelIcon&&null!==this.$store.state.deleCurrentRowId?this.recoveryStatus=1:this.recoveryStatus=0},handleCurrentChange:function(t){var e=new URLSearchParams;e.append("page",t),e.append("activeStatus",0),e.append("roomId",this.examRoomId),e.append("provinceCode",11e4),this.getData({params:e})},delCurRow:function(t){var e=this;this.recoveryStatus=1;var a=new URLSearchParams;a.append("id",t.id),a.append("activeStatus",1),this.$http.post("/api/plan/edit_plan",a).then(function(a){if(0===a.data.code&&"操作成功"===a.data.msg){e.$message({type:"success",showClose:!0,message:"删除成功"}),e.$store.dispatch("deleCurrentRow",t.id);var s=new URLSearchParams;s.append("roomId",e.examRoomId),s.append("activeStatus",0),s.append("provinceCode",11e4),e.getData({params:s})}else e.$message({type:"error",showClose:!0,message:"删除不成功"})})},UNDO:function(){var t=this,e=this.$store.state.deleCurrentRowId,a=new URLSearchParams;a.append("id",e),a.append("activeStatus",0),this.$http.post("/api/plan/edit_plan",a).then(function(e){if(0===e.data.code&&"操作成功"===e.data.msg){t.recoveryStatus=0;var a=new URLSearchParams;a.append("roomId",t.examRoomId),a.append("activeStatus",0),a.append("provinceCode",11e4),t.getData({params:a}),t.$message({type:"success",showClose:!0,message:"恢复成功"})}})},addTimeEvent:function(){this.timeList.push({}),this.timeList.length>6&&(this.$message({showClose:!0,message:"每天最多只能添加6场考试",type:"warning"}),this.timeList.length=6)},delCurTimeEmitter:function(t){this.timeList.splice(t,1)},changeLevel:function(t){this.form.examLev=t},addData:function(t){this.timeList[this.timeList.length-1]=t},setIntervalFn:function(){var t=this,e=setInterval(function(){if(t.timeOff--,t.timeOff<=0){t.dialogVisible=!1;var a=new URLSearchParams;a.append("roomId",t.examRoomId),a.append("activeStatus",0),a.append("provinceCode",11e4),t.getData({params:a}),clearInterval(e)}},1e3)},submitBtn:function(){var t=this,e=new URLSearchParams;e.append("roomId",this.examRoomId),e.append("examLevel",this.form.examLev),e.append("beginDate",this.selectDate[0]),e.append("endDate",this.selectDate[1]),e.append("timeStrs",o()(this.timeList)),this.muchDate=(this.selectDate[1].getTime()-this.selectDate[0].getTime())/864e5+1,this.$http.post("/api/plan/add_plan",e).then(function(e){if(0===e.data.code)new i.a(function(e,a){setTimeout(function(){t.dialogFormVisible=!1},2e3,"P1")}),new i.a(function(e,a){setTimeout(function(){t.dialogVisible=!0,t.setIntervalFn()},3500,"P2")})})}},mounted:function(){var t=this,e=new URLSearchParams;e.append("userId",1),e.append("provinceCode",11e4),this.$http.get("/api/room/get_room_by_province",{params:e}).then(function(e){200===e.status&&0===e.data.code&&(t.roomList=e.data.data)})}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"addPlanPages"},[a("commonTop",{attrs:{titleTop:t.title}}),t._v(" "),a("div",{staticClass:"examSelect"},[a("div",{staticClass:"prov"},[a("span",{staticClass:"commontips"},[t._v("考场:")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择考场"},on:{change:t.chooseRoom},model:{value:t.examRoomId,callback:function(e){t.examRoomId=e},expression:"examRoomId"}},t._l(t.roomList,function(t){return a("el-option",{key:t.id,attrs:{label:t.examRoomName,value:t.id}})}),1)],1),t._v(" "),a("p",[t._v("座位数:"),a("span",[t._v(t._s(t.realSeatings)+"个")])])]),t._v(" "),a("div",{staticClass:"examSelect"},[a("div",{staticClass:"prov"},[a("span",{staticClass:"commontips"},[t._v("考场计划:")]),t._v(" "),a("div",{staticClass:"btnGroup"},[a("el-button",{class:{deactive:0===t.addStatus,active:1===t.addStatus},attrs:{type:"primary",plain:"",disabled:0===t.addStatus},on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("新增")]),t._v(" "),a("el-button",{class:{deactive:0===t.delStatus,active:1===t.delStatus},attrs:{type:"primary",plain:"",disabled:0===t.delStatus},on:{click:t.showDelIconEvent}},[t._v("删除")]),t._v(" "),a("el-button",{class:{deactive:0===t.recoveryStatus,active:1===t.recoveryStatus},attrs:{type:"primary",plain:"",disabled:0===t.recoveryStatus},on:{click:t.UNDO}},[t._v("撤销")])],1)])]),t._v(" "),a("el-dialog",{attrs:{title:"新增计划",visible:t.dialogFormVisible,width:"580px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("div",{staticClass:"setTop clearfix"},[a("div",{staticClass:"setLev"},[a("p",[t._v("设置报考级别:")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择报考级别"},on:{change:t.changeLevel},model:{value:t.form.examLev,callback:function(e){t.$set(t.form,"examLev",e)},expression:"form.examLev"}},t._l(t.examLevClassify,function(t){return a("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})}),1)],1),t._v(" "),a("div",{staticClass:"setLev mgrt0"},[a("p",[t._v("选择日期:")]),t._v(" "),a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.selectDate,callback:function(e){t.selectDate=e},expression:"selectDate"}})],1),t._v(" "),a("div",{staticClass:"setTimer"},[a("p",[t._v("设置考试时间:")]),t._v(" "),t._l(t.timeList,function(e,s){return a("setTimeItem",{key:s,attrs:{examLev:t.form.examLev,curIndex:s},on:{delCurTimeEmitter:t.delCurTimeEmitter,addData:t.addData}})}),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",round:""},on:{click:t.addTimeEvent}},[t._v("增加")])],2),t._v(" "),a("p",[t._v("开放报名时间: 提前两周，当日早上8：00开放报名")])]),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",round:""},on:{click:t.submitBtn}},[t._v("完 成")])],1)]),t._v(" "),a("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("p",[a("span",[t._v("本次新增"+t._s(this.timeList.length*this.muchDate)+"条")]),t._v(" "),a("span",[t._v("成功"+t._s(this.timeList.length*this.muchDate)+"条")]),t._v(" "),a("span",[t._v("失败"+t._s(0)+"条")])]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("完 成("+t._s(t.timeOff)+")")])],1)]),t._v(" "),a("div",{staticClass:"tabs-data",attrs:{id:"addPlanTabs"}},[a("el-table",{staticStyle:{width:"862px"},attrs:{border:"",data:t.tableData}},[a("el-table-column",{attrs:{label:"日期",width:"153"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(e.row.examDate.split(" ")[0]))]),t._v(" "),a("span",[t._v("周"+t._s("日一二三四五六".charAt(new Date(e.row.examDate).getDay())))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"examTime",label:"考试时间",width:"102"}}),t._v(" "),a("el-table-column",{attrs:{label:"报考级别(考试时长)",width:"418"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.levelStr.replace(/,/g,"/")))]),t._v(" "),a("span",{staticStyle:{"margin-left":"10px"}},[t._v("("+t._s(e.row.timeStr)+"钟)")]),t._v(" "),t.showDelIcon?a("i",{staticClass:"el-icon-error",staticStyle:{cursor:"pointer",color:"#1f91b5","margin-left":"10px"},on:{click:function(a){return t.delCurRow(e.row)}}}):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"openTime",label:"开放报名时间",width:"188"}})],1),t._v(" "),t.tableData!==[]?a("p",{staticStyle:{"margin-top":"20px"}},[t._v("共有"+t._s(t.total)+"条结果")]):t._e(),t._v(" "),a("el-pagination",{attrs:{background:"",total:t.total,"page-size":t.pageSize,layout:"prev, pager, next","current-page":t.page},on:{"current-change":t.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var m=a("C7Lr")(c,d,!1,function(t){a("qQDG")},"data-v-223c4523",null).exports,p={data:function(){return{activeName:"2"}},components:{limiteRegistrationSet:a("2CUI").a,addPlanComponent:m},methods:{}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"planmanage commonRight"},[a("el-tabs",{attrs:{type:"border-card"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"1"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"iconfont icon-duanxintongzhi"}),t._v("限报设置")]),t._v(" "),a("limiteRegistrationSet")],1),t._v(" "),a("el-tab-pane",{attrs:{name:"2"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"iconfont icon-duanxinmobanguanli"}),t._v("考试计划")]),t._v(" "),a("addPlanComponent")],1)],1)],1)},staticRenderFns:[]};var v=a("C7Lr")(p,u,!1,function(t){a("n7pH")},"data-v-da9c1d26",null);e.default=v.exports},ZSpD:function(t,e,a){"use strict";var s={props:["examLev","curIndex"],data:function(){return{startExamTime:""}},computed:{endExamTime:function(){if(this.startExamTime){var t=new Date(this.startExamTime);switch(this.examLev){case 1:return t.setMinutes(t.getMinutes()+30);case 2:return t.setMinutes(t.getMinutes()+45);case 3:return t.setMinutes(t.getMinutes()+60);case 4:return t.setMinutes(t.getMinutes()+90)}}}},methods:{formatFn:function(t){var e=new Date(t),a=e.getHours(),s=e.getMinutes(),i="";return a<10&&(i+="0"),i+=a+":",s<10&&(i+="0"),i+=s},delCurTime:function(){this.$emit("delCurTimeEmitter",this.curIndex)},blurEvent:function(){var t={startTime:this.formatFn(this.startExamTime),endTime:this.formatFn(this.endExamTime)};this.$emit("addData",t)}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"setTimeCompotents"},[a("span",[t._v(t._s(t.curIndex+1))]),t._v(" "),a("el-time-picker",{attrs:{format:"HH 时 mm 分","picker-options":{selectableRange:"8:00:00 - 18:00:00"},placeholder:"设置开始时间"},on:{blur:t.blurEvent},model:{value:t.startExamTime,callback:function(e){t.startExamTime=e},expression:"startExamTime"}}),t._v(" "),a("el-time-picker",{attrs:{format:"HH 时 mm 分",disabled:"",placeholder:"考试结束时间"},model:{value:t.endExamTime,callback:function(e){t.endExamTime=e},expression:"endExamTime"}}),t._v(" "),a("i",{staticClass:"el-icon-error",staticStyle:{cursor:"pointer"},on:{click:t.delCurTime}})],1)},staticRenderFns:[]};var n=a("C7Lr")(s,i,!1,function(t){a("evp8")},"data-v-70d2fe9d",null);e.a=n.exports},evp8:function(t,e){},n7pH:function(t,e){},q1bu:function(t,e,a){var s=a("Rv9F"),i=s.JSON||(s.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}},qQDG:function(t,e){}});
//# sourceMappingURL=3.067100e7e127a5385708.js.map